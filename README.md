# Telegram → VK Publisher Bot

Бот для автоматической публикации постов и историй в сообщества ВКонтакте. Пользователь отправляет в Telegram фото/видео, текст со ссылками и уточнения по добавлению музыки/аудио во ВК — бот публикует в указанные группы.

## Возможности

- **Приём контента в Telegram:** фото (несколько), видео, текст со ссылками.
- **Публикация во ВК:** запись на стене сообщества и/или история.
- **Уточнения по аудио:** пользователь может указать, нужно ли добавлять музыку/аудио во ВК и оставить комментарий (название трека и т.д.). Само добавление трека в пост во ВК делается вручную или расширяется через API.

## Требования

- Python 3.10+
- Токен Telegram-бота ([@BotFather](https://t.me/BotFather))
- Токен доступа VK с правами: `wall`, `photos`, `stories`, `offline`, `groups`

## Установка

```bash
cd telegram-vk-publisher
python -m venv .venv
source .venv/bin/activate   # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

## Настройка

### Для владельца бота (один раз на сервере)

В `.env` нужен **только токен Telegram-бота**. Остальное хранится в облаке.

```bash
cp .env.example .env
```

В `.env` укажите:
```env
TELEGRAM_BOT_TOKEN=ваш_токен_от_BotFather
```

### Для каждого пользователя бота (в чате Telegram)

Каждый пользователь вводит **свои** VK-данные прямо в боте — они сохраняются в облачной БД на сервере и привязываются к его Telegram.

1. В Telegram отправьте боту команду **`/setup`**.
2. По запросу бота отправьте **VK Access Token** (одним сообщением).  
   Как получить: [Управление приложениями ВК](https://vk.com/apps?act=manage) → приложение с правами `wall`, `photos`, `stories`, `offline`, `groups`.
3. Отправьте **ID групп ВК** через запятую, например: `-123456789, -987654321`.
4. При желании укажите **ID группы для историй** или напишите «Пропустить».

Данные хранятся в папке `data/` на сервере (SQLite). Папка `data/` в `.gitignore` — в репозиторий не попадает.

## Запуск

```bash
python main.py
```

## Использование в Telegram

1. **`/start`** — приветствие и краткая инструкция.
2. **`/setup`** — ввести свой VK-токен и ID групп (данные сохраняются в облаке, привязаны к вашему Telegram).
3. **`/post`** — начать новый пост:
   - Отправьте одно или несколько фото, или одно видео.
   - Отправьте текст поста (можно со ссылками) или напишите «Пропустить».
   - Выберите кнопками: **Только пост**, **Только история**, **Пост + история**.
   - При необходимости нажмите **Добавить музыку/аудио во ВК** и при желании напишите уточнение (название трека и т.д.).
   - Нажмите **Опубликовать** (или после уточнения по аудио отправьте **`/publish_now`**).
4. **`/cancel`** — отменить текущий пост.

## Структура проекта

- `main.py` — запуск бота.
- `config.py` — загрузка настроек из `.env` (только токен бота).
- `storage.py` — хранение VK-учётных данных пользователей (SQLite в `data/`).
- `models.py` — модель запроса на публикацию.
- `handlers.py` — обработчики команд и медиа в Telegram (FSM), в том числе `/setup`.
- `vk_client.py` — клиент VK API (стена, истории).
- `downloads/` — временные файлы по пользователям (создаётся автоматически).
- `data/` — база учётных данных (создаётся автоматически, в `.gitignore`).

## Ограничения и развитие

- Видео на стену ВК из бота пока не загружается (можно добавить через `video.getUploadServer` и т.д.).
- Добавление музыки в пост во ВК по уточнению пользователя не реализовано автоматически — бот сохраняет уточнение и выводит его; логику можно дописать через VK API при необходимости.
- Истории ВК: используется один медиа-файл (первое фото или видео).
